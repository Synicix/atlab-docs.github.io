

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Synicix ML Pipeline &mdash; atlab-docs 0.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'0.0.0',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Synicix ML Pipeline API Documentation" href="synicix_ml_pipeline_modules.html" />
    <link rel="prev" title="Stimulus" href="stimulus.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> atlab-docs
          

          
          </a>

          
            
            
              <div class="version">
                0.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="datajoint.html">DataJoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubernetes.html">Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="stimulus.html">Stimulus</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Synicix ML Pipeline</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overview-on-architecture">Overview on Architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#datasetconfig-modelconfig-trainingconfig">DatasetConfig, ModelConfig, TrainingConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trainingtask">TrainingTask</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trainingresult">TrainingResult</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#handling-of-abstraction">Handling of Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-pipeline">Using the Pipeline</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#jupyter-notebook-example">Jupyter Notebook example:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#directory-setup">Directory Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#datasetconfig">DatasetConfig</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#definition">Definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#additional-details-on-the-attributes">Additional Details on the Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#additional-notes-on-dataloader-default-beheavior">Additional Notes on Dataloader Default Beheavior</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implementation-of-a-dataset-class">Implementation of a Dataset Class</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inserting-into-datasetconfig">Inserting into DatasetConfig</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#modelconfig">ModelConfig</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implementation-of-a-model-class">Implementation of a Model Class</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inserting-into-modelconfig">Inserting into ModelConfig</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#trainingconfig">TrainingConfig</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">Definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Additional Details on the Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implementing-a-trainer-class">Implementing a Trainer Class</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id4">TrainingTask</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">Definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inserting-into-trainingtask">Inserting into TrainingTask</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id6">TrainingResult</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id7">Definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#populating-trainingresult">Populating TrainingResult:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#other-resources">Other Resources:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="synicix_ml_pipeline_modules.html">Synicix ML Pipeline API Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">atlab-docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Synicix ML Pipeline</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/synicix_ml_pipeline_tutorial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="synicix-ml-pipeline">
<h1>Synicix ML Pipeline<a class="headerlink" href="#synicix-ml-pipeline" title="Permalink to this headline">¶</a></h1>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li>Datajoint</li>
<li>Docker</li>
<li>K8</li>
<li>Pytorch</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="introduction">
<h2>Introduction:<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Synicix ML Pipeline is a pytorch based machine learning pipeline built to facilitate training machine learning models on various dataset with different training configuration as well provide various other useful tools such as fp16 mixed precision training.</p>
<p>In order to keep improving the pipeline, please file bugs and feature request to the Github Repo under the Other Resrouces section</p>
</div>
<div class="section" id="overview-on-architecture">
<h2>Overview on Architecture<a class="headerlink" href="#overview-on-architecture" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="_images/synicix_ml_pipeline_erd.png"><img alt="_images/synicix_ml_pipeline_erd.png" class="align-center" src="_images/synicix_ml_pipeline_erd.png" style="width: 100%;" /></a>
<div class="section" id="datasetconfig-modelconfig-trainingconfig">
<h3>DatasetConfig, ModelConfig, TrainingConfig<a class="headerlink" href="#datasetconfig-modelconfig-trainingconfig" title="Permalink to this headline">¶</a></h3>
<p>At the core of the pipeline is <strong>Dataset Config</strong>, <strong>Models Config</strong>, and <strong>Training Config</strong> shown in their respective tables above.
These core tables handles the defining what dataset and model to use and how to train as the name suggesst</p>
</div>
<div class="section" id="trainingtask">
<h3>TrainingTask<a class="headerlink" href="#trainingtask" title="Permalink to this headline">¶</a></h3>
<p>Following the three core tables is the <strong>Training Task</strong> table which serves as a table indiciating what combination of <strong>Dataset Config</strong>, <strong>Model Config</strong>, and <strong>Training Config</strong> should be fed thorugh the pipeline.
Typically this is use to restrict to a subset of all possiable combination between the 3 core tables.</p>
</div>
<div class="section" id="trainingresult">
<h3>TrainingResult<a class="headerlink" href="#trainingresult" title="Permalink to this headline">¶</a></h3>
<p>After that we have the <strong>Training Result</strong> table which handles storing the training of every combination in the <strong>Training Task</strong> table.</p>
<p><strong>DatasetConfig</strong>, <strong>ModelConfig</strong>, <strong>TrainingConfig</strong>, and <strong>TrainingTask</strong> are <strong>dj.Manual Tables</strong>, while TrainingResult is <strong>dj.Computed</strong></p>
</div>
</div>
<div class="section" id="handling-of-abstraction">
<h2>Handling of Abstraction<a class="headerlink" href="#handling-of-abstraction" title="Permalink to this headline">¶</a></h2>
<p>In order to deal the possability various needs and use cases the pipeline was built with heavy abstraction in mind via the import module libaray provided by python.</p>
<p>Due to this, you will often see table definition requiring <strong>model_class_name</strong> and <strong>class_name</strong> which basically tells the pipeline what class to import from where.
Futher details will be covered the following sections.</p>
</div>
<div class="section" id="using-the-pipeline">
<h2>Using the Pipeline<a class="headerlink" href="#using-the-pipeline" title="Permalink to this headline">¶</a></h2>
<div class="section" id="jupyter-notebook-example">
<h3>Jupyter Notebook example:<a class="headerlink" href="#jupyter-notebook-example" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/cajal/SynicixMLPipeline/blob/master/Pipeline%20Configuration.ipynb">https://github.com/cajal/SynicixMLPipeline/blob/master/Pipeline%20Configuration.ipynb</a></p>
<p><strong>Note: however this only shows the inserting and not how to create your own dataset and models to be used in this pipeline, as such the following section will go into more detail behind that.</strong></p>
</div>
</div>
<div class="section" id="directory-setup">
<h2>Directory Setup<a class="headerlink" href="#directory-setup" title="Permalink to this headline">¶</a></h2>
<p>Before running any code the pipeline typically requires certain global variable paths to be defined.</p>
<ul class="simple">
<li><strong>dj.config[‘store’][‘external_training_results’]:</strong> Where to store the external blobs for the TrainingResult table</li>
<li><strong>dataset_dir:</strong> Where the dataset files are stored</li>
<li><strong>dataset_cache_dir:</strong> Where to cache the dataset files to the local computer when training</li>
<li><strong>model_save_dir:</strong> Where to save the model checkpoint files to</li>
</ul>
<p>Here is example:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datajoint</span> <span class="k">as</span> <span class="nn">dj</span>


<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;nt&#39;</span><span class="p">:</span>
    <span class="n">dj</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;stores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">external_training_result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">protocol</span><span class="o">=</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">mnt</span><span class="se">\\</span><span class="s1">scratch07</span><span class="se">\\</span><span class="s1">external&#39;</span><span class="p">))</span>
    <span class="n">dataset_dir</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">at-storage3.ad.bcm.edu</span><span class="se">\\</span><span class="s1">scratch07</span><span class="se">\\</span><span class="s1">synicix_dev</span><span class="se">\\</span><span class="s1">datasets</span><span class="se">\\</span><span class="s1">&#39;</span>
    <span class="n">dataset_cache_dir</span> <span class="o">=</span> <span class="s1">&#39;C:</span><span class="se">\\\\</span><span class="s1">dataset_cache</span><span class="se">\\</span><span class="s1">&#39;</span>
    <span class="n">model_save_dir</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">at-storage3.ad.bcm.edu</span><span class="se">\\</span><span class="s1">scratch07</span><span class="se">\\</span><span class="s1">synicix_dev</span><span class="se">\\</span><span class="s1">model_storage</span><span class="se">\\</span><span class="s1">&#39;</span>
<span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;posix&#39;</span><span class="p">:</span>
    <span class="n">dj</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;stores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">external_training_result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">protocol</span><span class="o">=</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;/mnt/scratch07/external/training_result&#39;</span><span class="p">))</span>
    <span class="n">dataset_dir</span> <span class="o">=</span> <span class="s1">&#39;/mnt/scratch07/synicix_dev/datasets/&#39;</span>
    <span class="n">dataset_cache_dir</span> <span class="o">=</span> <span class="s1">&#39;dataset_cache/&#39;</span>
    <span class="n">model_save_dir</span> <span class="o">=</span> <span class="s1">&#39;/mnt/scratch07/synicix_dev/model_storage/&#39;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="datasetconfig">
<h2>DatasetConfig<a class="headerlink" href="#datasetconfig" title="Permalink to this headline">¶</a></h2>
<p>A dj.Manual table class that handle the storage dataset configs with details on what dataset class and params to load that dataset and dataloader with.</p>
<div class="section" id="definition">
<h3>Definition<a class="headerlink" href="#definition" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    dataset_config_md5_hash : char(128)</span>
<span class="s2">    ---</span>
<span class="s2">    dataset_file_name                   : varchar(256)</span>
<span class="s2">    dataset_type                        : varchar(256)</span>
<span class="s2">    dataset_class_module_name           : varchar(256)</span>
<span class="s2">    dataset_class_name                  : varchar(256)</span>
<span class="s2">    dataset_class_params                : longblob</span>
<span class="s2">    train_sampler_module_name           : varchar(256)</span>
<span class="s2">    train_sampler_class_name            : varchar(256)</span>
<span class="s2">    train_sampler_class_params          : longblob</span>
<span class="s2">    validation_sampler_module_name      : varchar(256)</span>
<span class="s2">    validation_sampler_class_name       : varchar(256)</span>
<span class="s2">    validation_sampler_class_params     : longblob</span>
<span class="s2">    test_sampler_module_name            : longblob</span>
<span class="s2">    test_sampler_class_name             : varchar(256)</span>
<span class="s2">    test_sampler_class_params           : longblob</span>
<span class="s2">    input_shape                         : longblob</span>
<span class="s2">    output_shape                        : longblob</span>
<span class="s2">    additional_model_params             : longblob</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="additional-details-on-the-attributes">
<h3>Additional Details on the Attributes<a class="headerlink" href="#additional-details-on-the-attributes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>dataset_class_module_name, dataset_class_name, dataset_class_params:</strong> Details what pytorch based dataset_class it should import (user defined) [REQUIRED]</li>
<li><strong>(train, validation, test) _sampler_module_name, _sampler_class_name, _sampler_class_params:</strong> What pytorch sampler class should be passed into the respective dataloader (user defined) [If not defined it will default to pytroch default dataloader Sampler]</li>
<li><strong>input_shape, output_shape:</strong> These are computed via the validation dataset and is passed to the model during the model creation [Requires validation examples]</li>
<li><strong>additional_model_params:</strong> Obatin from calling get_additional_model_params from the dataset class [No additional params should be defined as dict()]</li>
</ul>
</div>
<div class="section" id="additional-notes-on-dataloader-default-beheavior">
<h3>Additional Notes on Dataloader Default Beheavior<a class="headerlink" href="#additional-notes-on-dataloader-default-beheavior" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>By default, if sampler for train is not defined then shuffle will be set to True, else False</li>
<li>By default, if sampler for (validation/test) is not defined then shuffle will be set to False</li>
</ul>
</div>
<div class="section" id="implementation-of-a-dataset-class">
<h3>Implementation of a Dataset Class<a class="headerlink" href="#implementation-of-a-dataset-class" title="Permalink to this headline">¶</a></h3>
<p>Dataset Config expects a pytorch base dataset class with a few additional requirements:</p>
<p><strong>The following functions need to be defined</strong>:</p>
<ul class="simple">
<li><strong>__len___(self):</strong> Pytorch Dataset requirement</li>
<li><strong>__getitem__(self, index):</strong>: Pytorch Dataset requirement</li>
<li><strong>get_additional_model_params(self):</strong> DatasetConfig requirement, use to define additional_model_params</li>
</ul>
<p><strong>Example:</strong>
<a class="reference internal" href="synicix_ml_pipeline.dataset_classes.html#neurodatadataset"><span class="std std-ref">synicix_ml_pipeline.dataset_classes.NeuroDataDataset module</span></a></p>
</div>
<div class="section" id="inserting-into-datasetconfig">
<h3>Inserting into DatasetConfig<a class="headerlink" href="#inserting-into-datasetconfig" title="Permalink to this headline">¶</a></h3>
<p>DatasetConfig has a insert_tuples functions to handle the computation of md5_hash as well other infomation such as input_shape and etc. As such one should always use this function to insert into the table</p>
<p>Below is an example of how to insert multiple DatasetConfigs:</p>
<p>(<strong>NOTE: Please note that dataset_dir and dataset_cache_dir must be defined ahead of time</strong>):</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Get all dataset file name under the dataset_dir and insert them</span>
<span class="n">dataset_file_names</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dataset_dir</span><span class="p">)</span>

<span class="n">tuple_dicts_to_insert</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">dataset_file_name</span> <span class="ow">in</span> <span class="n">dataset_file_names</span><span class="p">:</span>
    <span class="n">tuple_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">dataset_file_name</span> <span class="o">=</span> <span class="n">dataset_file_name</span><span class="p">,</span>
        <span class="n">dataset_type</span> <span class="o">=</span> <span class="s1">&#39;NeuroDataDataset&#39;</span><span class="p">,</span>
        <span class="n">dataset_class_module_name</span> <span class="o">=</span> <span class="s1">&#39;synicix_ml_pipeline.dataset_classes.NeuroDataDataset&#39;</span><span class="p">,</span>
        <span class="n">dataset_class_name</span> <span class="o">=</span> <span class="s1">&#39;NeuroDataDataset&#39;</span><span class="p">,</span>
        <span class="n">dataset_class_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full-encoding&#39;</span><span class="p">),</span>
        <span class="n">train_sampler_module_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">train_sampler_class_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">train_sampler_class_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span>
        <span class="n">validation_sampler_module_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">validation_sampler_class_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">validation_sampler_class_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span>
        <span class="n">test_sampler_module_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">test_sampler_class_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">test_sampler_class_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span>
    <span class="p">)</span>

    <span class="n">tuple_dicts_to_insert</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_dict</span><span class="p">)</span>

<span class="n">dataset_config</span><span class="o">.</span><span class="n">insert_tuples</span><span class="p">(</span><span class="n">tuple_dicts_to_insert</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="modelconfig">
<h2>ModelConfig<a class="headerlink" href="#modelconfig" title="Permalink to this headline">¶</a></h2>
<p>A dj.Manual table class that handle the storage of pytorch models definition along with some helper function to help load the models</p>
<div class="section" id="id1">
<h3>Definition<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    model_config_md5_hash       : char(128)   # MD5 Hash of network_class_name + network_module_code</span>
<span class="s2">    ---</span>
<span class="s2">    model_class_module_name     : varchar(256)</span>
<span class="s2">    model_class_name            : varchar(256)   # Class name of the network</span>
<span class="s2">    model_class_params          : longblob</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="implementation-of-a-model-class">
<h3>Implementation of a Model Class<a class="headerlink" href="#implementation-of-a-model-class" title="Permalink to this headline">¶</a></h3>
<p>The pipeline expects the standard pytorch model with a few additional requirements</p>
<p><strong>The following functions need to be defined</strong>:</p>
<ul class="simple">
<li><strong>__init__(self, input_shape, output_shape):</strong> Pytorch Dataset where input_shape and output_shape are required by the pipeline</li>
<li><strong>forward(self, x):</strong>: Pytorch Dataset requirement, <strong>must return two variables: output, regularlization loss</strong></li>
</ul>
<p><strong>Example:</strong>
<a class="reference internal" href="synicix_ml_pipeline.models.html#simplemlp"><span class="std std-ref">synicix_ml_pipeline.models.SimpleMLP module</span></a></p>
</div>
<div class="section" id="inserting-into-modelconfig">
<h3>Inserting into ModelConfig<a class="headerlink" href="#inserting-into-modelconfig" title="Permalink to this headline">¶</a></h3>
<p>ModelConfig has a insert_tuples functions to handle the computation of md5_hash, as such one should always use this function to insert into the table.</p>
<p>Below is an example of how to insert into ModelConfig:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">tuple_dicts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">tuple_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">model_class_module_name</span><span class="o">=</span><span class="s1">&#39;synicix_ml_pipeline.models.SimpleMLP&#39;</span><span class="p">,</span>
    <span class="n">model_class_name</span><span class="o">=</span><span class="s1">&#39;SimpleMLP&#39;</span><span class="p">,</span>
    <span class="n">model_class_params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">num_hidden_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hidden_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">l1_loss_lamda</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">l2_loss_lamda</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">tuple_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_dict</span><span class="p">)</span>

<span class="n">model_config</span><span class="o">.</span><span class="n">insert_tuples</span><span class="p">(</span><span class="n">tuple_dicts</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="trainingconfig">
<h2>TrainingConfig<a class="headerlink" href="#trainingconfig" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>Definition<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    training_config_md5_hash   : char(128) # MD5 Hash of attribute below</span>
<span class="s2">    ---</span>
<span class="s2">    trainer_class_module_name                       : varchar(256)</span>
<span class="s2">    trainer_class_name                              : varchar(256)</span>
<span class="s2">    trainer_class_params                            : longblob</span>
<span class="s2">    batch_size                                      : smallint unsigned</span>
<span class="s2">    epoch_limit                                     : int unsigned</span>
<span class="s2">    optimizer_class_module_name                     : varchar(256)</span>
<span class="s2">    optimizer_class_name                            : varchar(256)</span>
<span class="s2">    optimizer_class_params                          : longblob</span>
<span class="s2">    criterion_class_module_name                     : varchar(256)</span>
<span class="s2">    criterion_class_name                            : varchar(256)</span>
<span class="s2">    criterion_class_params                          : longblob</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id3">
<h3>Additional Details on the Attributes<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>trainer_class_module_name, trainer_class_name, trainer_class_params:</strong> Details what trainer it should import and use, default will be NNTrainer located under synicix_ml_pipeline/trainers/NNTrainer.py (user defined) [REQUIRED]</li>
<li><strong>optimizer_class_module_name, optimizer_class_name, optimizer_class_params:</strong> Details what pytorch based optimizer it should import and use (user defined) [REQUIRED]</li>
<li><strong>criterion_class_module_name, criterion_class_name, criterion_class_params:</strong> Details what pytorch based criterion it should import and use (user defined) [REQUIRED]</li>
</ul>
</div>
<div class="section" id="implementing-a-trainer-class">
<h3>Implementing a Trainer Class<a class="headerlink" href="#implementing-a-trainer-class" title="Permalink to this headline">¶</a></h3>
<p><strong>Required init parameters:</strong></p>
<ul class="simple">
<li><strong>train_dataloader</strong> (pytorch dataloader)</li>
<li><strong>validation_dataloader</strong> (pytorch dataloader)</li>
<li><strong>test_dataloader</strong> (pytorch dataloader)</li>
<li><strong>device</strong> (pytorch device)</li>
<li><strong>model_class</strong> (user defined)</li>
<li><strong>model_class_params</strong> (user defined dict)</li>
<li><strong>optimizer_class</strong> (user defined)</li>
<li><strong>optimizer_class_params</strong> (user defined dict)</li>
<li><strong>criterion_class</strong> (user defined)</li>
<li><strong>criterion_class_params</strong> (user defined dict)</li>
<li><strong>model_save_path</strong> (str)</li>
<li><strong>max_epoch</strong> (int)</li>
</ul>
<p><strong>Required functions:</strong></p>
<ul class="simple">
<li><strong>train(self):</strong> Function to start training process</li>
<li><strong>validate(self):</strong> Function to run the validate dataset</li>
<li><strong>evaluate(self, return_outputs_targets_and_loss=False):</strong> Function to run the test dataset and return loss or a dict of (outputs, targets, and loss)</li>
<li><strong>load_best_performing_model(self):</strong> Load best the load best performing model once training is done</li>
</ul>
<p><strong>Example:</strong>
<a class="reference internal" href="synicix_ml_pipeline.trainers.html#nntrainer"><span class="std std-ref">synicix_ml_pipeline.trainers.NNTrainer module</span></a></p>
</div>
</div>
<div class="section" id="id4">
<h2>TrainingTask<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>This table serves as a subset of all possiable Dataset, Model and Training Config combination. Whatever is inserted here will be trained with its result recorded in TrainnigResult</p>
<div class="section" id="id5">
<h3>Definition<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    training_task_md5_hash   : char(128) # MD5 Hash of attribute below</span>
<span class="s2">    ---</span>
<span class="s2">    -&gt; DatasetConfig</span>
<span class="s2">    -&gt; ModelConfig</span>
<span class="s2">    -&gt; TrainingConfig</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="inserting-into-trainingtask">
<h3>Inserting into TrainingTask<a class="headerlink" href="#inserting-into-trainingtask" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">dataset_config_keys</span> <span class="o">=</span> <span class="p">(</span><span class="n">DatasetConfig</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;KEY&#39;</span><span class="p">)</span>
<span class="n">model_config_keys</span> <span class="o">=</span><span class="p">(</span><span class="n">ModelConfig</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;KEY&#39;</span><span class="p">)</span>
<span class="n">training_config_keys</span> <span class="o">=</span> <span class="p">(</span><span class="n">TrainingConfig</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;KEY&#39;</span><span class="p">)</span>

<span class="n">tuple_dicts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Insert the possiable combination base on the restrictions above</span>
<span class="k">for</span> <span class="n">dataset_config_key</span> <span class="ow">in</span> <span class="n">dataset_config_keys</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">model_config_key</span> <span class="ow">in</span> <span class="n">model_config_keys</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">training_config_key</span> <span class="ow">in</span> <span class="n">training_config_keys</span><span class="p">:</span>
            <span class="n">tuple_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

            <span class="n">tuple_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dataset_config_key</span><span class="p">)</span>
            <span class="n">tuple_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">model_config_key</span><span class="p">)</span>
            <span class="n">tuple_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">training_config_key</span><span class="p">)</span>

            <span class="n">tuple_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuple_dict</span><span class="p">)</span>

<span class="n">training_task</span><span class="o">.</span><span class="n">insert_tuple</span><span class="p">(</span><span class="n">tuple_dicts</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="id6">
<h2>TrainingResult<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id7">
<h3>Definition<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; TrainingTask</span>
<span class="s2">    ---</span>
<span class="s2">    test_score                                      : float</span>
<span class="s2">    training_epoch_loss_history                     : blob@external_training_result</span>
<span class="s2">    validation_epoch_loss_history                   : blob@external_training_result</span>
<span class="s2">    regularization_loss_history                     : blob@external_training_result</span>
<span class="s2">    model_class_params_history                      : blob@external_training_result</span>
<span class="s2">    model_save_path                                 : varchar(256)</span>
<span class="s2">    utc_insert_time = CURRENT_TIMESTAMP             : timestamp</span>
<span class="s2">    &quot;&quot;&quot;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="populating-trainingresult">
<h3>Populating TrainingResult:<a class="headerlink" href="#populating-trainingresult" title="Permalink to this headline">¶</a></h3>
<p>TrainingResult will require dataset_dir, dataset_cache_dir, model_save_dir, and num_workers to be defined, where num_workers is number of dataloaders threads.</p>
<p>Typical usesage of populating TrainingResult is done via a .py script and K8</p>
<p><strong>training_script.py</strong></p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">datajoint</span> <span class="k">as</span> <span class="nn">dj</span>
<span class="kn">from</span> <span class="nn">synicix_ml_pipeline.datajoint_tables.TrainingResult</span> <span class="kn">import</span> <span class="n">TrainingResult</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;nt&#39;</span><span class="p">:</span>
        <span class="n">dj</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;stores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">external_training_resul</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">protocol</span><span class="o">=</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">mnt</span><span class="se">\\</span><span class="s1">scratch07</span><span class="se">\\</span><span class="s1">external&#39;</span><span class="p">))</span>
        <span class="n">dataset_dir</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">at-storage3.ad.bcm.edu</span><span class="se">\\</span><span class="s1">scratch07</span><span class="se">\\</span><span class="s1">synicix_dev</span><span class="se">\\</span><span class="s1">datasets</span><span class="se">\\</span><span class="s1">&#39;</span>
        <span class="n">dataset_cache_dir</span> <span class="o">=</span> <span class="s1">&#39;C:</span><span class="se">\\\\</span><span class="s1">dataset_cache</span><span class="se">\\</span><span class="s1">&#39;</span>
        <span class="n">model_save_dir</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">at-storage3.ad.bcm.edu</span><span class="se">\\</span><span class="s1">scratch07</span><span class="se">\\</span><span class="s1">synicix_dev</span><span class="se">\\</span><span class="s1">model_storage</span><span class="se">\\</span><span class="s1">&#39;</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;posix&#39;</span><span class="p">:</span>
        <span class="n">dj</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;stores&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">external_training_result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">protocol</span><span class="o">=</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;/mnt/scratch07/external/training_result&#39;</span><span class="p">))</span>
        <span class="n">dataset_dir</span> <span class="o">=</span> <span class="s1">&#39;/mnt/scratch07/synicix_dev/datasets/&#39;</span>
        <span class="n">dataset_cache_dir</span> <span class="o">=</span> <span class="s1">&#39;dataset_cache/&#39;</span>
        <span class="n">model_save_dir</span> <span class="o">=</span> <span class="s1">&#39;/mnt/scratch07/synicix_dev/model_storage/&#39;</span>

    <span class="c1"># Get num_workers from args</span>
    <span class="n">num_workers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Create the TrainingResult instance</span>
    <span class="n">training_result</span> <span class="o">=</span> <span class="n">TrainingResult</span><span class="p">(</span><span class="n">dataset_dir</span><span class="o">=</span><span class="n">dataset_dir</span><span class="p">,</span> <span class="n">dataset_cache_dir</span><span class="o">=</span><span class="n">dataset_cache_dir</span><span class="p">,</span> <span class="n">model_save_dir</span><span class="o">=</span><span class="n">model_save_dir</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">)</span>

    <span class="c1"># Being populating</span>
    <span class="n">training_result</span><span class="o">.</span><span class="n">populate</span><span class="p">(</span><span class="n">reserve_jobs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;random&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p><strong>K8 population yaml file</strong></p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">batch/v1</span> <span class="c1"># Jobs Default K8 API</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Job</span> <span class="c1"># This tells kubernetes what kind of class it is working with</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">synicix-ml-pipeline</span> <span class="c1"># Name of the Job</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="nt">parallelism</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">110</span> <span class="c1">#</span>
<span class="nt">template</span><span class="p">:</span> <span class="c1"># Pod Templete</span>
    <span class="nt">spec</span><span class="p">:</span>
    <span class="nt">restartPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Never</span> <span class="c1"># Options are OnFailure, and Never.</span>
    <span class="nt">hostNetwork</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span> <span class="c1"># This option will allow the pod to use the host network for internet access</span>
    <span class="nt">tolerations</span><span class="p">:</span> <span class="c1"># This toleration allows the pod to be schedule onto gpu-only pod machines, remove this if you are not using gpu</span>
    <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="s">&quot;gpu&quot;</span>
        <span class="nt">operator</span><span class="p">:</span> <span class="s">&quot;Equal&quot;</span>
        <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;true&quot;</span>
        <span class="nt">effect</span><span class="p">:</span> <span class="s">&quot;NoSchedule&quot;</span>
    <span class="nt">volumes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mnt</span>
        <span class="l l-Scalar l-Scalar-Plain">hostPath</span><span class="p p-Indicator">:</span>
        <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/mnt</span> <span class="c1"># Directory on the host machine to be mounted</span>
    <span class="nt">affinity</span><span class="p">:</span> <span class="c1"># Affinity to select certain nodes with 11GB, 12GB, or 24GB memory</span>
        <span class="nt">nodeAffinity</span><span class="p">:</span>
        <span class="nt">requiredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span> <span class="c1"># Require nodes to have this label</span>
            <span class="nt">nodeSelectorTerms</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">matchExpressions</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gpu_mem_size</span> <span class="c1"># Target label is gpu_mem_size</span>
                <span class="nt">operator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span> <span class="c1"># Key must have one of the following values</span>
                <span class="nt">values</span><span class="p">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">8GB</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">11GB</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">12GB</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">24GB</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">32GB</span>
        <span class="nt">preferredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">weight</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
            <span class="l l-Scalar l-Scalar-Plain">preference</span><span class="p p-Indicator">:</span>
            <span class="nt">matchExpressions</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tensor_cores</span>
                <span class="l l-Scalar l-Scalar-Plain">operator</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
                <span class="l l-Scalar l-Scalar-Plain">values</span><span class="p p-Indicator">:</span>
                <span class="p p-Indicator">-</span> <span class="s">&quot;true&quot;</span>
    <span class="nt">containers</span><span class="p">:</span> <span class="c1"># Container Level</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">synicix-ml-pipeline</span> <span class="c1"># Container name (Can be set to whatever)</span>
        <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">synicix/pytorch-fp16-base:latest</span> <span class="c1"># Docker Image hosted on Docker Hub</span>
        <span class="nt">resources</span><span class="p">:</span>
        <span class="nt">limits</span><span class="p">:</span>
            <span class="nt">nvidia.com/gpu</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span> <span class="c1"># requesting 1 GPUs</span>
        <span class="nt">volumeMounts</span><span class="p">:</span> <span class="c1"># Container reference to volumes define above</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mnt</span> <span class="c1"># Name of the volume define above</span>
        <span class="nt">mountPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/mnt</span> <span class="c1"># Location of where to mount it in the container</span>
        <span class="nt">env</span><span class="p">:</span> <span class="c1"># This section refers to secrets created under the user namespace and set them as enviorment variables</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DJ_HOST</span>
        <span class="nt">valueFrom</span><span class="p">:</span>
            <span class="nt">secretKeyRef</span><span class="p">:</span>
            <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">datajoint-credentials</span>
            <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DJ_HOST</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DJ_USER</span>
        <span class="nt">valueFrom</span><span class="p">:</span>
            <span class="nt">secretKeyRef</span><span class="p">:</span>
            <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">datajoint-credentials</span>
            <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DJ_USER</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DJ_PASS</span>
        <span class="nt">valueFrom</span><span class="p">:</span>
            <span class="nt">secretKeyRef</span><span class="p">:</span>
            <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">datajoint-credentials</span>
            <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DJ_PASS</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">GITHUB_USERNAME</span>
        <span class="nt">valueFrom</span><span class="p">:</span>
            <span class="nt">secretKeyRef</span><span class="p">:</span>
            <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">github-credentials</span>
            <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">GITHUB_USERNAME</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">GITHUB_PASSWORD</span>
        <span class="nt">valueFrom</span><span class="p">:</span>
            <span class="nt">secretKeyRef</span><span class="p">:</span>
            <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">github-credentials</span>
            <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">GITHUB_PASSWORD</span>
        <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;/bin/bash&quot;</span><span class="p p-Indicator">]</span> <span class="c1"># Entry point for the container</span>
        <span class="nt">args</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;git</span><span class="nv"> </span><span class="s">clone</span><span class="nv"> </span><span class="s">https://$(GITHUB_USERNAME):$(GITHUB_PASSWORD)@github.com/Synicix/SynicixMLPipeline.git</span><span class="nv"> </span><span class="s">\</span>
        <span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">pip3</span><span class="nv"> </span><span class="s">install</span><span class="nv"> </span><span class="s">/SynicixMLPipeline</span><span class="nv"> </span><span class="s">\</span>
        <span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">python3</span><span class="nv"> </span><span class="s">-u</span><span class="nv"> </span><span class="s">/SynicixMLPipeline/K8/TrainingDeployment/training_script.py</span><span class="nv"> </span><span class="s">0&quot;</span><span class="p p-Indicator">]</span> <span class="c1"># sh commands to clone and run python script</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="other-resources">
<h2>Other Resources:<a class="headerlink" href="#other-resources" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line"><strong>GitHub</strong>: <a class="reference external" href="https://github.com/cajal/SynicixMLPipeline?organization=cajal&amp;organization=cajal">https://github.com/cajal/SynicixMLPipeline?organization=cajal&amp;organization=cajal</a></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="synicix_ml_pipeline_modules.html" class="btn btn-neutral float-right" title="Synicix ML Pipeline API Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="stimulus.html" class="btn btn-neutral float-left" title="Stimulus" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Synicix

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>